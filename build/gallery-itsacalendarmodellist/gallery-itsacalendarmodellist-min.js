YUI.add("gallery-itsacalendarmodellist",function(e,t){"use strict";function m(){}var n=e.Lang,r=e.Array,i=e.Object,s=i.hasKey,o=e.DataType.Date,u=o.isValidDate,a=function(e){return new Date(e.getTime())},f=function(e,t){t.setTime(e.getTime())},l=function(e,t){e.setTime(e.getTime()+6e4*t)},c=function(e,t){var n=e.getFullYear(),r=e.getMonth()+t;n=Math.floor(n+r/12),r=(r%12+12)%12,e.setFullYear(n),e.setMonth(r)},h=function(e,t){e.setTime(e.getTime()+864e5*t)},p=function(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},d=function(e,t){return o.isGreater(e,t)&&!p(e,t)},v=function(e,t){return o.isGreater(e,t)||p(e,t)};m.ATTRS={modelList:{value:null,lazyAdd:!1,validator:function(t){return t instanceof e.ModelList||t===null},setter:"_setModelList"},modelConfig:{value:null,validator:function(e){return n.isObject(e)||e===null},setter:"_setModelConfig"}},e.mix(m.prototype,{_fireModelsEvent:null,_afterRenderEvent:null,_syncModelListEvent:null,_syncModelListCheckEvent:null,_modelConfigInitiated:!1,_modelListInitiated:!1,_internalUpdate:!1,initializer:function(){var e=this;e._fireModelsEvent=e.after("selectionChange",e._fireSelectedModels)},getModels:function(e,t){var i=this,s=[],u,f,l,c,p,v;if(n.isArray(e))s=i._getSelectedModelList({newSelection:e,validateDate:!0});else if(o.isValidDate(e)){v=function(e){r.indexOf(s,e)===-1&&s.push(e)};if(!o.isValidDate(t)||d(e,t))t=a(e);c=new Date(e.getTime());do u=c.getFullYear(),f=c.getMonth(),l=c.getDate(),p=i._storedModelDates[u]&&i._storedModelDates[u][f]&&i._storedModelDates[u][f][l]||[],r.each(p,v),h(c,1);while(!d(c,t))}return s},dateHasModels:function(e){var t=this,n=t._storedModelDates,r=e.getFullYear(),i=e.getMonth(),s=e.getDate(),o=n[r]&&n[r][i]&&n[r][i][s]||[],u=o.length>0;return u},getModelsInDate:function(e){var t=this;return t.getModels(e)},getModelsInWeek:function(e){var t=this,n=e.getDay(),r=a(e),i=a(e);return h(r,-n),h(i,6-n),t.getModels(r,i)},getModelsInMonth:function(e){var t=this,n=a(e),r=o.addMonths(e,1);return n.setDate(1),r.setDate(1),h(r,-1),t.getModels(n,r)},getModelsInYear:function(e){var t=this,n=new Date(e,0,1),r=new Date(e,11,31);return t.getModels(n,r)},destructor:function(){var e=this;e._clearSyncSubscriptionModelList(),e._fireModelsEvent&&e._fireModelsEvent.detach(),e._afterRenderEvent&&e._afterRenderEvent.detach()},_clearSyncSubscriptionModelList:function(){var e=this;e._syncModelListEvent&&e._syncModelListEvent.detach(),e._syncModelListCheckEvent&&e._syncModelListCheckEvent.detach()},_setModelConfig:function(e){var t=this;t._modelConfigInitiated&&!t._internalUpdate?t._syncModelList(null,null,e):t._modelConfigInitiated=!0},_setModelList:function(e){var t=this,r=t.get("modelConfig")||{},s=r.date,o,u;!s&&e&&e.size()>0&&(o=e.item(0),i.some(o.getAttrs(),function(e,t){return u=n.isDate(e),u&&(s=t),u}),u&&(t._internalUpdate=!0,r.date=s,t.set("modelConfig",r),t._internalUpdate=!1)),t._clearSyncSubscriptionModelList(),e&&(t._syncModelListEvent=e.after(["add","remove","reset"],t._syncModelList,t),t._syncModelListCheckEvent=e.after("*:change",t._checkSyncModelList,t)),t._modelListInitiated||e?t._syncModelList(null,e):t._modelListInitiated=!0},_checkSyncModelList:function(t){var n=this,r=n.get("modelConfig")||{},i=r.date||"",s=r.enddate||"",o=r.count||"",u=r.intervalMinutes||"",a=r.intervalHours||"",f=r.intervalDays||"",l=r.intervalMonths||"";if(t.changed[i]||t.changed[s]||t.changed[o]||t.changed[u]||t.changed[a]||t.changed[f]||t.changed[l])n.get("rendered")?n._doSyncModelList():n._afterRenderEvent=n.after("render",e.bind(n._doSyncModelList,n))},_syncModelList:function(t,n,r){var i=this;i.get("rendered")?i._doSyncModelList(n,r):i._afterRenderEvent=i.after("render",e.bind(i._doSyncModelList,i,n,r))},_doSyncModelList:function(e,t){var r=this,s=e||r.get("modelList"),o=t||r.get("modelConfig")||{},m=o.date,g=o.enddate,y=o.count,b=o.intervalMinutes,w=o.intervalHours,E=o.intervalDays,S=o.intervalMonths,x=[],T,N,C,k,L;r.clearMarkedDates(s&&m),L=i.size(r._storedModelDates),r._storedModelDates={},s&&m?(!g&&!y?T=function(e){var t=e.get(m);u(t)&&(x.push(t),r._storeModelDate(e,t))}:g&&!y?T=function(e){var t=e.get(m),n=e.get(g)||t;if(u(t)){u(n)||(n=t),N=a(t);do x.push(a(N)),r._storeModelDate(e,N),h(N,1);while(v(n,N))}}:!g&&y?T=function(e){var t=e.get(m),i=e.get(y)||1,s=b&&e.get(b),o=w&&e.get(w),h=E&&e.get(E),d=S&&e.get(S),v;if(u(t)){n.isNumber(i)||(i=1),n.isNumber(s)||(s=0),n.isNumber(o)||(o=0),n.isNumber(h)||(h=0),n.isNumber(d)||(d=0),v=1440*h+60*o+s,v===0&&d===0&&(v=1440),N=a(t),k=new Date(0);for(C=0;C<i;C++)p(N,k)||(x.push(a(N)),r._storeModelDate(e,N)),f(N,k),v>0&&l(N,v),d>0&&c(N,d)}}:g&&y&&(N=new Date(0),T=function(e){var t=e.get(m),i=e.get(g)||t,s=e.get(y)||1,o=b&&e.get(b),p=w&&e.get(w),T=E&&e.get(E),L=S&&e.get(S),A,O,M;if(u(t)){u(i)||(i=t),n.isNumber(s)||(s=1),n.isNumber(o)||(o=0),n.isNumber(p)||(p=0),n.isNumber(T)||(T=0),n.isNumber(L)||(L=0),A=1440*T+60*p+o,A===0&&L===0&&(A=1440),O=a(t),M=a(i),k=new Date(0);for(C=0;C<s;C++){f(O,N);do d(N,k)&&(x.push(a(N)),r._storeModelDate(e,N)),h(N,1);while(v(M,N));f(N,k),h(k,-1),A>0&&(l(O,A),l(M,A)),L>0&&(c(O,L),c(M,L))}}}),s.each(T),r.markDates(x),r._fireSelectedModels()):L>0&&r._fireSelectedModels()},_storeModelDate:function(e,t){var n=this,r=t.getFullYear(),i=t.getMonth(),o=t.getDate();s(n._storedModelDates,r)||(n._storedModelDates[r]={}),s(n._storedModelDates[r],i)||(n._storedModelDates[r][i]={}),s(n._storedModelDates[r][i],o)||(n._storedModelDates[r][i][o]=[]),n._storedModelDates[r][i][o].push(e)},_fireSelectedModels:function(e){var t=this;t.fire("modelSelectionChange",{newModelSelection:t._getSelectedModelList(e)})},_getSelectedModelList:function(e){var t=this,n=e&&e.newSelection||t.get("selectedDates"),i=[];return r.each(n,function(n){if(e&&!e.validateDate||o.isValidDate(n)){var s=n.getFullYear(),u=n.getMonth(),a=n.getDate(),f=t._storedModelDates[s]&&t._storedModelDates[s][u]&&t._storedModelDates[s][u][a]||[];r.each(f,function(e){r.indexOf(i,e)===-1&&i.push
(e)})}}),i}},!0),e.Calendar.ITSACalendarModelList=m,e.Base.mix(e.Calendar,[m])},"gallery-2013.02.27-21-03",{requires:["base-build","calendar-base","model","model-list","datatype-date-math","gallery-itsacalendarmarkeddates"]});
